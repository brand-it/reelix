<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reelix - Plex-Friendly DVD & Blu-ray Ripper</title>
  <meta name="description" content="Simple, cross-platform tool to rip DVDs and Blu-ray discs into Plex-friendly digital files. Free and open source." />
  <link rel="icon" type="image/png" href="icon.png" />
  <link href="index.css" rel="stylesheet" />
  <link href="icons.css" rel="stylesheet" />
</head>
<body class="bg-dark text-light">

  <!-- Hero Section -->
  <div class="container py-5">
    <div class="row align-items-center">
      <div class="col-lg-6 text-center text-lg-start mb-4 mb-lg-0">
        <div class="d-flex align-items-center justify-content-center justify-content-lg-start mb-3">
          <img src="icon.png" alt="Reelix Icon" class="rounded-3 me-3" style="width:80px;"/>
          <h1 class="display-4 fw-bold mb-0">Reelix</h1>
        </div>
        <p class="lead text-white-50 mb-4">
          A simple, powerful tool that helps you rip your DVDs and Blu-ray discs into Plex-friendly digital files.
        </p>

        <!-- Download Button -->
        <div class="mb-3">
          <a id="btn-download" href="#" class="btn btn-success btn-lg shadow-lg px-5 py-3">
            <i class="bi bi-download me-2"></i>
            <span id="download-text">Download for Your Platform</span>
          </a>
          <div class="mt-2">
            <small id="download-sub" class="text-white-50 d-block">Loading latest version...</small>
            <a id="link-changelog" href="#" class="text-secondary small">View Changelog</a>
          </div>
        </div>

        <!-- Quick Links -->
        <div class="d-flex gap-3 justify-content-center justify-content-lg-start flex-wrap">
          <a href="https://github.com/brand-it/reelix" class="btn btn-outline-light btn-sm" target="_blank" rel="noopener">
            <i class="bi bi-github me-1"></i> GitHub
          </a>
          <a href="https://github.com/brand-it/reelix/issues" class="btn btn-outline-light btn-sm" target="_blank" rel="noopener">
            <i class="bi bi-bug me-1"></i> Report Issue
          </a>
        </div>
      </div>

      <!-- Preview -->
      <div class="col-lg-6">
        <img src="preview.gif"
             class="rounded-3 shadow-lg img-fluid"
             alt="Reelix Preview"
             loading="eager"
             style="max-width: 100%; height: auto;" />
      </div>
    </div>
  </div>

  <!-- Features Section -->
  <div class="bg-black bg-opacity-25 py-5">
    <div class="container">
      <h2 class="text-center mb-4">Key Features</h2>
      <div class="row g-4">
        <div class="col-md-4">
          <div class="card bg-dark border-secondary h-100">
            <div class="card-body text-center py-4">
              <div class="fs-1 text-success mb-2"><i class="bi bi-lightning-charge-fill"></i></div>
              <h5 class="card-title mb-2">Fast & Reliable</h5>
              <p class="card-text text-white-50 mb-0">Efficiently rip your media using MakeMKV technology with progress tracking.</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card bg-dark border-secondary h-100">
            <div class="card-body text-center py-4">
              <div class="fs-1 text-success mb-2"><i class="bi bi-tv-fill"></i></div>
              <h5 class="card-title mb-2">Plex-Ready</h5>
              <p class="card-text text-white-50 mb-0">Automatically organizes files with proper naming for seamless Plex integration.</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card bg-dark border-secondary h-100">
            <div class="card-body text-center py-4">
              <div class="fs-1 text-success mb-2"><i class="bi bi-laptop"></i></div>
              <h5 class="card-title mb-2">Cross-Platform</h5>
              <p class="card-text text-white-50 mb-0">Works on macOS, Windows, and Linux with native performance.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Platform Support -->
  <div class="container py-5">
    <h2 class="text-center mb-4">Platform Support</h2>
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <ul class="list-group list-group-flush">
          <li class="list-group-item bg-dark text-light border-secondary d-flex justify-content-between align-items-center py-3">
            <div>
              <i class="bi bi-apple fs-4 me-3 text-white-50"></i>
              <strong>macOS</strong>
              <span class="text-white-50 ms-2">(Intel & Apple Silicon)</span>
            </div>
            <span class="badge bg-success rounded-pill px-3 py-2">Extensively Tested</span>
          </li>
          <li class="list-group-item bg-dark text-light border-secondary d-flex justify-content-between align-items-center py-3">
            <div>
              <i class="bi bi-windows fs-4 me-3 text-white-50"></i>
              <strong>Windows</strong>
              <span class="text-white-50 ms-2">(64-bit)</span>
            </div>
            <span class="badge bg-warning text-dark rounded-pill px-3 py-2">Tested</span>
          </li>
          <li class="list-group-item bg-dark text-light border-secondary d-flex justify-content-between align-items-center py-3">
            <div>
              <i class="bi bi-ubuntu fs-4 me-3 text-white-50"></i>
              <strong>Linux</strong>
              <span class="text-white-50 ms-2">(Debian, RPM, AppImage)</span>
            </div>
            <span class="badge bg-secondary rounded-pill px-3 py-2">Community Support</span>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-black bg-opacity-50 py-4 mt-5">
    <div class="container text-center text-white-50">
      <p class="mb-2">Open source and free forever</p>
      <p class="small mb-0">
        Built with <i class="bi bi-heart-fill text-danger"></i> using Tauri &amp; Rust
      </p>
    </div>
  </footer>


  <script>

    /**
    * Detects platform +, on macOS, whether it’s Intel or Apple Silicon.
    * @returns { 'windows' | 'linux' | 'mac-intel' | 'mac-arm' | 'mac' | 'unknown' }
    */
    function detectPlatform() {
      const p = navigator.platform.toLowerCase();
      const ua = navigator.userAgent.toLowerCase();

      // 1) Windows?
      if (p.includes("win")) return "windows";
      // 2) Linux?
      if (p.includes("linux") || ua.includes("x11") || ua.includes("ubuntu"))
        return "linux";
      // 3) Mac?
      if (p.includes("mac")) {
        const arch = detectMacArch();
        if (arch === "intel") return "mac-intel";
        if (arch === "arm") return "mac-arm";
        return "mac";
      }
      return "unknown";
    }

    /**
    * @returns { 'intel' | 'arm' | null }
    */
    function detectMacArch() {
      // Client Hints (Chrome 107+)
      if (navigator.userAgentData && navigator.userAgentData.architecture) {
        const a = navigator.userAgentData.architecture.toLowerCase();
        if (a.includes("arm")) return "arm";
        if (a.includes("x86")) return "intel";
      }

      // WebGL renderer sniff
      try {
        const canvas = document.createElement("canvas");
        const gl =
          canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
        const dbg = gl && gl.getExtension("WEBGL_debug_renderer_info");
        if (dbg) {
          const renderer = gl
            .getParameter(dbg.UNMASKED_RENDERER_WEBGL)
            .toLowerCase();
          if (renderer.includes("apple m") || renderer.includes("apple a"))
            return "arm";
          if (
            renderer.includes("intel") ||
            renderer.includes("radeon") ||
            renderer.includes("nvidia")
          )
            return "intel";
        }
      } catch (e) {
        // ignore
      }

      // Fallback: UA string
      const ua = navigator.userAgent.toLowerCase();
      if (ua.includes("arm64") || ua.includes("aarch64")) return "arm";
      if (ua.includes("intel") || ua.includes("x86_64")) return "intel";

      return null;
    }

    async function getLatest() {
      const r = await fetch('https://api.github.com/repos/brand-it/reelix/releases/latest');
      if (!r.ok) throw new Error(r.status);
      return r.json();
    }

    /**
    * Chooses the correct release asset based on detected platform.
    * @param {Array} assets  – the GitHub release assets
    * @param {string} osKey  – one of 'windows','linux','mac-intel','mac-arm','mac'
    * @returns {object|undefined} the matching asset, or undefined if none found
    */
    function pickAsset(assets, osKey) {
      const list = name => assets.filter(a => a.name.toLowerCase().includes(name));
      const ends  = ext => a => a.name.toLowerCase().endsWith(ext);

      let candidate;

      if (osKey === 'windows') {
        // Prefer MSI over EXE
        candidate = assets.find(ends('.msi')) || assets.find(ends('.exe'));

      } else if (osKey === 'linux') {
        // Prefer DEB, then RPM, then AppImage
        candidate = assets.find(ends('.deb'))
                || assets.find(ends('.rpm'))
                || assets.find(ends('.appimage'));

      } else if (osKey === 'mac-intel') {
        // x64 DMG first, then x64 tar.gz
        candidate = list('x64').find(ends('.dmg'))
                || list('x64').find(ends('.app.tar.gz'));

      } else if (osKey === 'mac-arm') {
        // aarch64 DMG first, then aarch64 tar.gz
        candidate = list('aarch64').find(ends('.dmg'))
                || list('aarch64').find(ends('.app.tar.gz'));

      } else if (osKey === 'mac') {
        // Fallback: any DMG, then any tar.gz
        candidate = assets.find(ends('.dmg'))
                || assets.find(ends('.app.tar.gz'));
      }

      return candidate;
    }

    (async () => {
      try {
        const rel = await getLatest();
        const tag = rel.tag_name;
        const os  = detectPlatform();
        console.log('Detected platform:', os);
        console.log('Available assets:', rel.assets);
        const asset = pickAsset(rel.assets, os);

        // Update button text based on platform
        const platformNames = {
          'windows': 'Windows',
          'linux': 'Linux',
          'mac-intel': 'macOS (Intel)',
          'mac-arm': 'macOS (Apple Silicon)',
          'mac': 'macOS',
          'unknown': 'Your Platform'
        };

        if (asset) {
          document.getElementById('btn-download').href = asset.browser_download_url;
          document.getElementById('download-text').textContent = `Download for ${platformNames[os] || 'Your Platform'}`;
          document.getElementById('download-sub')
            .textContent = `${tag} · ${(asset.size/1024/1024).toFixed(1)} MB`;
          document.getElementById('link-changelog')
            .href = `https://github.com/brand-it/reelix/releases/tag/${tag}`;
        } else {
          document.getElementById('btn-download').href = 'https://github.com/brand-it/reelix/releases';
          document.getElementById('download-text').textContent = 'View All Releases';
          document.getElementById('download-sub')
            .textContent = `Platform-specific builds available`;
          document.getElementById('link-changelog').style.display = 'none';
        }
      } catch (e) {
        console.error('Error loading release info:', e);
        document.getElementById('btn-download').href = 'https://github.com/brand-it/reelix/releases';
        document.getElementById('download-text').textContent = 'View Releases';
        document.getElementById('download-sub')
          .textContent = `Visit GitHub to download`;
        document.getElementById('link-changelog').style.display = 'none';
      }
    })();
  </script>
</body>
</html>
